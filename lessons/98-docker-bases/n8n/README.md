# n8n Docker Setup with Official Tunnel

Complete Docker setup for running n8n workflow automation platform with PostgreSQL database and built-in tunnel support for webhooks.

## Features

- n8n workflow automation platform
- PostgreSQL 15 database for production use
- Built-in n8n tunnel for external webhooks
- Local data persistence with Docker volumes
- Docker Compose for easy orchestration
- Timezone configuration (America/Lima)

## Quick Start

### 1. Start services
```bash
make up
```

### 2. Access n8n
After starting, check logs for the tunnel URL:
```bash
make logs
```

You'll see output like:
```
Tunnel URL: https://cqm6lgb0ucrqpwgzdfwugaw3.hooks.n8n.cloud/
Editor is now accessible via:
https://cqm6lgb0ucrqpwgzdfwugaw3.hooks.n8n.cloud
```

### 3. Local access (port 5678)
For local development: **http://localhost:5678**

### 4. External webhooks
Use the tunnel URL for external services like WhatsApp, GitHub, etc.

## Available Commands

- `make up` - Start n8n with built-in tunnel
- `make down` - Stop and remove containers  
- `make stop` - Stop containers without removing
- `make clean` - Remove containers, images and data
- `make logs` - Show container logs (includes tunnel URL)
- `make shell` - Open shell in running container
- `make help` - Show all available commands

## Data Persistence

- n8n data: Docker volume `n8n_data` (workflows, credentials, settings)
- PostgreSQL data: Docker volume `postgres_data`
- Files: `./files` directory

## Database Configuration

- **Database**: PostgreSQL 15
- **Host**: postgres (internal)
- **Database**: n8n
- **User**: n8n
- **Password**: n8n123

## Environment Variables

Key configuration in `.env`:

- `GENERIC_TIMEZONE=America/Lima` - n8n timezone
- `TZ=America/Lima` - System timezone
- `N8N_HOST=0.0.0.0` - Host binding
- `N8N_PORT=5678` - Port number
- `N8N_SECURE_COOKIE=false` - Allows HTTP access
- `N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=true` - Security
- `N8N_RUNNERS_ENABLED=true` - Task runners enabled

## Webhook Configuration

### For external services (WhatsApp, GitHub, etc.):
Use the tunnel URL from logs:
```
https://cqm6lgb0ucrqpwgzdfwugaw3.hooks.n8n.cloud/webhook/your-webhook-name
```

### Important Notes:
- The tunnel URL is automatically generated by n8n
- It provides HTTPS access for external webhooks
- The URL remains the same as long as the container is running
- Port 5678 is used for internal tunnel services, not web access

## Updating

### Updating Docker Compose

If you run n8n using a Docker Compose file, follow these steps to update n8n:

```bash
# Navigate to the directory containing your docker compose file
cd </path/to/your/compose/file/directory>

# Pull latest version
docker compose pull

# Stop and remove older version
docker compose down

# Start the container
docker compose up -d
```

### Using Command Line

To update n8n, you can also use the command line to pull the latest, or a specific version:

```bash
# Pull latest (stable) version
docker pull docker.n8n.io/n8nio/n8n

# Pull specific version
docker pull docker.n8n.io/n8nio/n8n:1.106.3

# Pull next (unstable) version
docker pull docker.n8n.io/n8nio/n8n:next
```

After pulling the updated image, stop your n8n container and start it again:

```bash
# Find your container ID
docker ps -a

# Stop the container with the `<container_id>`
docker stop <container_id>

# Remove the container with the `<container_id>`
docker rm <container_id>

# Start the container
docker run --name=<container_name> [options] -d docker.n8n.io/n8nio/n8n
```

## Security

⚠️ **Important**: The tunnel exposes your n8n instance to the internet. Use only for development and testing. Never share the tunnel URL publicly.

## Docker Compose Structure

```yaml
services:
  postgres:    # PostgreSQL 15 database
  n8n:         # n8n with --tunnel flag
```

No reverse proxy needed - n8n handles everything internally.

## Latest and Next Versions

n8n releases a new minor version most weeks. The `latest` version is for production use. `next` is the most recent release. You should treat `next` as a beta: it may be unstable.

Current `latest`: 1.106.3  
Current `next`: 1.107.1

## Additional Resources

- [n8n Docker hosting repository](https://github.com/n8n-io/n8n-hosting)
- [n8n official documentation](https://docs.n8n.io/hosting/installation/docker/)
- [Docker Compose configurations](https://github.com/n8n-io/n8n-hosting/tree/main/docker-compose)